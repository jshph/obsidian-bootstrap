/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __markAsModule = (target) => __defProp(target, "__esModule", { value: true });
var __export = (target, all) => {
  __markAsModule(target);
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __reExport = (target, module2, desc) => {
  if (module2 && typeof module2 === "object" || typeof module2 === "function") {
    for (let key of __getOwnPropNames(module2))
      if (!__hasOwnProp.call(target, key) && key !== "default")
        __defProp(target, key, { get: () => module2[key], enumerable: !(desc = __getOwnPropDesc(module2, key)) || desc.enumerable });
  }
  return target;
};
var __toModule = (module2) => {
  return __reExport(__markAsModule(__defProp(module2 != null ? __create(__getProtoOf(module2)) : {}, "default", module2 && module2.__esModule && "default" in module2 ? { get: () => module2.default, enumerable: true } : { value: module2, enumerable: true })), module2);
};

// main.ts
__export(exports, {
  default: () => Caterpillage
});
var import_obsidian = __toModule(require("obsidian"));
var path = __toModule(require("path"));
var fs = __toModule(require("fs"));
var DEFAULT_SETTINGS = {
  sourceTag: "#tocopy",
  targetVaultPath: "",
  unwantedPatterns: [],
  pathMappings: []
};
var Caterpillage = class extends import_obsidian.Plugin {
  async onload() {
    await this.loadSettings();
    this.addRibbonIcon("copy", "Copy Tagged Notes", () => {
      console.log("Copy Tagged Notes");
      this.copyTaggedNotes();
    });
    this.addSettingTab(new CaterpillageSettingTab(this.app, this));
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
  getTagListFromFrontmatter(frontmatter) {
    if (!frontmatter.tags || frontmatter.tags.length === 0) {
      return [];
    }
    if (Array.isArray(frontmatter.tags)) {
      return frontmatter.tags.map((tag) => tag.includes("#") ? tag : "#" + tag);
    } else if (typeof frontmatter.tags === "string") {
      return [frontmatter.tags];
    } else {
      return [];
    }
  }
  async copyTaggedNotes() {
    var _a;
    const files = this.app.vault.getMarkdownFiles();
    for (const file of files) {
      const metadata = this.app.metadataCache.getFileCache(file);
      let tags = ((_a = metadata.tags) == null ? void 0 : _a.map((tag) => tag.tag)) || [];
      if (metadata == null ? void 0 : metadata.frontmatter) {
        tags = [
          ...tags,
          ...this.getTagListFromFrontmatter(metadata == null ? void 0 : metadata.frontmatter)
        ];
      }
      if (tags == null ? void 0 : tags.includes(this.settings.sourceTag)) {
        const processedContent = await this.processContent(file);
        const fileName = path.basename(file.path);
        const targetPath = path.join(this.settings.targetVaultPath, fileName);
        if (!fs.existsSync(targetPath)) {
          await this.writeFile(targetPath, processedContent);
        }
        if (metadata.embeds) {
          for (const embed of metadata.embeds) {
            const baseLink = embed.link.split("#")[0];
            const embedFile = this.app.metadataCache.getFirstLinkpathDest(baseLink, "/");
            if (!embedFile) {
              continue;
            }
            const embedFileName = path.basename(embedFile.path);
            const embedFileDirectory = path.dirname(embedFile.path);
            const pathMapping = this.settings.pathMappings.find((mapping) => embedFileDirectory.includes(mapping[0]));
            const dir = pathMapping ? path.join(this.settings.targetVaultPath, pathMapping[1]) : this.settings.targetVaultPath;
            const embedTargetPath = path.join(dir, embedFileName);
            if (fs.existsSync(embedTargetPath)) {
              continue;
            }
            const processedContent2 = await this.processContent(embedFile);
            await this.writeFile(embedTargetPath, processedContent2);
          }
        }
      }
    }
  }
  async processContent(file) {
    var _a;
    const content = await this.app.vault.read(file);
    let processedContent = content;
    const combinedRegex = new RegExp(this.settings.unwantedPatterns.join("|"), "g");
    processedContent = processedContent.replace(combinedRegex, "");
    const frontmatter = (_a = this.app.metadataCache.getFileCache(file)) == null ? void 0 : _a.frontmatter;
    if (frontmatter && frontmatter.tags) {
      const frontmatterTags = this.getTagListFromFrontmatter(frontmatter);
      frontmatter.tags = frontmatterTags.filter((tag) => tag !== this.settings.sourceTag);
      const yamlFrontmatter = Object.entries(frontmatter).map(([key, value]) => {
        if (Array.isArray(value)) {
          return `${key}:
${value.map((item) => `  - ${item}`).join("\n")}`;
        } else if (value === void 0 || value === null) {
          return `${key}:`;
        }
        return `${key}: ${value}`;
      }).join("\n");
      processedContent = processedContent.replace(/---[\s\S]*?---/, `---
${yamlFrontmatter}
---`);
    }
    return processedContent;
  }
  async writeFile(filePath, content) {
    await fs.promises.mkdir(path.dirname(filePath), { recursive: true });
    await fs.promises.writeFile(filePath, content, "utf8");
  }
};
var CaterpillageSettingTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    new import_obsidian.Setting(containerEl).setName("Source Tag").setDesc("Tag to identify notes to be copied").addText((text) => text.setPlaceholder("Enter tag").setValue(this.plugin.settings.sourceTag).onChange(async (value) => {
      this.plugin.settings.sourceTag = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Target Vault Path").setDesc("Path to the target vault").addText((text) => text.setPlaceholder("Enter path").setValue(this.plugin.settings.targetVaultPath).onChange(async (value) => {
      this.plugin.settings.targetVaultPath = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Unwanted Patterns").setDesc("Regex patterns to match and remove unwanted content").addTextArea((text) => text.setPlaceholder("Enter unwanted regex patterns (newline-separated)").setValue(this.plugin.settings.unwantedPatterns.join("\n")).onChange(async (value) => {
      this.plugin.settings.unwantedPatterns = value.split("\n");
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Path Mappings").setDesc("Newline-separated source and destination path mappings (e.g., source1,destination1 <newline> source2,destination2)").addTextArea((text) => text.setPlaceholder("Enter path mappings").setValue(this.plugin.settings.pathMappings.map((mapping) => mapping.join(",")).join("\n")).onChange(async (value) => {
      this.plugin.settings.pathMappings = value.split("\n").map((mapping) => mapping.split(",").map((item) => item.trim()));
      await this.plugin.saveSettings();
    }));
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQXBwLCBQbHVnaW4sIFBsdWdpblNldHRpbmdUYWIsIFNldHRpbmcsIFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gXCJwYXRoXCI7XG5pbXBvcnQgKiBhcyBmcyBmcm9tIFwiZnNcIjtcblxuaW50ZXJmYWNlIENhdGVycGlsbGFnZVNldHRpbmdzIHtcbiAgc291cmNlVGFnOiBzdHJpbmc7XG4gIHRhcmdldFZhdWx0UGF0aDogc3RyaW5nO1xuICB1bndhbnRlZFBhdHRlcm5zOiBzdHJpbmdbXTsgLy8gTmV3IGZpZWxkIGZvciB1bndhbnRlZCByZWdleCBwYXR0ZXJuXG4gIHBhdGhNYXBwaW5nczogc3RyaW5nW11bXTtcbn1cblxuY29uc3QgREVGQVVMVF9TRVRUSU5HUzogQ2F0ZXJwaWxsYWdlU2V0dGluZ3MgPSB7XG4gIHNvdXJjZVRhZzogXCIjdG9jb3B5XCIsXG4gIHRhcmdldFZhdWx0UGF0aDogXCJcIixcbiAgdW53YW50ZWRQYXR0ZXJuczogW10sIC8vIE5ldyBmaWVsZCBmb3IgdW53YW50ZWQgcmVnZXggcGF0dGVyblxuICBwYXRoTWFwcGluZ3M6IFtdLFxufTtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2F0ZXJwaWxsYWdlIGV4dGVuZHMgUGx1Z2luIHtcbiAgc2V0dGluZ3M6IENhdGVycGlsbGFnZVNldHRpbmdzO1xuXG4gIGFzeW5jIG9ubG9hZCgpIHtcbiAgICBhd2FpdCB0aGlzLmxvYWRTZXR0aW5ncygpO1xuXG4gICAgdGhpcy5hZGRSaWJib25JY29uKFwiY29weVwiLCBcIkNvcHkgVGFnZ2VkIE5vdGVzXCIsICgpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKFwiQ29weSBUYWdnZWQgTm90ZXNcIik7XG4gICAgICB0aGlzLmNvcHlUYWdnZWROb3RlcygpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5hZGRTZXR0aW5nVGFiKG5ldyBDYXRlcnBpbGxhZ2VTZXR0aW5nVGFiKHRoaXMuYXBwLCB0aGlzKSk7XG4gIH1cblxuICBhc3luYyBsb2FkU2V0dGluZ3MoKSB7XG4gICAgdGhpcy5zZXR0aW5ncyA9IE9iamVjdC5hc3NpZ24oe30sIERFRkFVTFRfU0VUVElOR1MsIGF3YWl0IHRoaXMubG9hZERhdGEoKSk7XG4gIH1cblxuICBhc3luYyBzYXZlU2V0dGluZ3MoKSB7XG4gICAgYXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcbiAgfVxuXG4gIGdldFRhZ0xpc3RGcm9tRnJvbnRtYXR0ZXIoZnJvbnRtYXR0ZXIpOiBzdHJpbmdbXSB7XG4gICAgaWYgKCFmcm9udG1hdHRlci50YWdzIHx8IGZyb250bWF0dGVyLnRhZ3MubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgaWYgKEFycmF5LmlzQXJyYXkoZnJvbnRtYXR0ZXIudGFncykpIHtcbiAgICAgIHJldHVybiBmcm9udG1hdHRlci50YWdzLm1hcCgodGFnKSA9PlxuICAgICAgICB0YWcuaW5jbHVkZXMoXCIjXCIpID8gdGFnIDogXCIjXCIgKyB0YWdcbiAgICAgICk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgZnJvbnRtYXR0ZXIudGFncyA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgcmV0dXJuIFtmcm9udG1hdHRlci50YWdzXTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGNvcHlUYWdnZWROb3RlcygpIHtcbiAgICBjb25zdCBmaWxlcyA9IHRoaXMuYXBwLnZhdWx0LmdldE1hcmtkb3duRmlsZXMoKTtcbiAgICBmb3IgKGNvbnN0IGZpbGUgb2YgZmlsZXMpIHtcbiAgICAgIGNvbnN0IG1ldGFkYXRhID0gdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUoZmlsZSk7XG5cbiAgICAgIGxldCB0YWdzID0gbWV0YWRhdGEudGFncz8ubWFwKCh0YWcpID0+IHRhZy50YWcpIHx8IFtdO1xuICAgICAgaWYgKG1ldGFkYXRhPy5mcm9udG1hdHRlcikge1xuICAgICAgICB0YWdzID0gW1xuICAgICAgICAgIC4uLnRhZ3MsXG4gICAgICAgICAgLi4udGhpcy5nZXRUYWdMaXN0RnJvbUZyb250bWF0dGVyKG1ldGFkYXRhPy5mcm9udG1hdHRlciksXG4gICAgICAgIF07XG4gICAgICB9XG4gICAgICBpZiAodGFncz8uaW5jbHVkZXModGhpcy5zZXR0aW5ncy5zb3VyY2VUYWcpKSB7XG4gICAgICAgIGNvbnN0IHByb2Nlc3NlZENvbnRlbnQgPSBhd2FpdCB0aGlzLnByb2Nlc3NDb250ZW50KGZpbGUpO1xuICAgICAgICBjb25zdCBmaWxlTmFtZSA9IHBhdGguYmFzZW5hbWUoZmlsZS5wYXRoKTtcbiAgICAgICAgY29uc3QgdGFyZ2V0UGF0aCA9IHBhdGguam9pbih0aGlzLnNldHRpbmdzLnRhcmdldFZhdWx0UGF0aCwgZmlsZU5hbWUpO1xuXG4gICAgICAgIGlmICghZnMuZXhpc3RzU3luYyh0YXJnZXRQYXRoKSkge1xuICAgICAgICAgIGF3YWl0IHRoaXMud3JpdGVGaWxlKHRhcmdldFBhdGgsIHByb2Nlc3NlZENvbnRlbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRXh0cmFjdCBlbWJlZHMgZnJvbSB0aGUgY29udGVudFxuICAgICAgICBpZiAobWV0YWRhdGEuZW1iZWRzKSB7XG4gICAgICAgICAgZm9yIChjb25zdCBlbWJlZCBvZiBtZXRhZGF0YS5lbWJlZHMpIHtcbiAgICAgICAgICAgIGNvbnN0IGJhc2VMaW5rID0gZW1iZWQubGluay5zcGxpdChcIiNcIilbMF07XG4gICAgICAgICAgICBjb25zdCBlbWJlZEZpbGUgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpcnN0TGlua3BhdGhEZXN0KFxuICAgICAgICAgICAgICBiYXNlTGluayxcbiAgICAgICAgICAgICAgXCIvXCJcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGlmICghZW1iZWRGaWxlKSB7XG4gICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBlbWJlZEZpbGVOYW1lID0gcGF0aC5iYXNlbmFtZShlbWJlZEZpbGUucGF0aCk7XG4gICAgICAgICAgICBjb25zdCBlbWJlZEZpbGVEaXJlY3RvcnkgPSBwYXRoLmRpcm5hbWUoZW1iZWRGaWxlLnBhdGgpO1xuICAgICAgICAgICAgY29uc3QgcGF0aE1hcHBpbmcgPSB0aGlzLnNldHRpbmdzLnBhdGhNYXBwaW5ncy5maW5kKChtYXBwaW5nKSA9PlxuICAgICAgICAgICAgICBlbWJlZEZpbGVEaXJlY3RvcnkuaW5jbHVkZXMobWFwcGluZ1swXSlcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGNvbnN0IGRpciA9IHBhdGhNYXBwaW5nXG4gICAgICAgICAgICAgID8gcGF0aC5qb2luKHRoaXMuc2V0dGluZ3MudGFyZ2V0VmF1bHRQYXRoLCBwYXRoTWFwcGluZ1sxXSlcbiAgICAgICAgICAgICAgOiB0aGlzLnNldHRpbmdzLnRhcmdldFZhdWx0UGF0aDtcblxuICAgICAgICAgICAgY29uc3QgZW1iZWRUYXJnZXRQYXRoID0gcGF0aC5qb2luKGRpciwgZW1iZWRGaWxlTmFtZSk7XG5cbiAgICAgICAgICAgIGlmIChmcy5leGlzdHNTeW5jKGVtYmVkVGFyZ2V0UGF0aCkpIHtcbiAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IHByb2Nlc3NlZENvbnRlbnQgPSBhd2FpdCB0aGlzLnByb2Nlc3NDb250ZW50KGVtYmVkRmlsZSk7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLndyaXRlRmlsZShlbWJlZFRhcmdldFBhdGgsIHByb2Nlc3NlZENvbnRlbnQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHByb2Nlc3NDb250ZW50KGZpbGU6IFRGaWxlKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlKTtcblxuICAgIC8vIFJlbW92ZSBiYXNlZCBvbiByZWdleFxuICAgIGxldCBwcm9jZXNzZWRDb250ZW50ID0gY29udGVudDtcbiAgICBjb25zdCBjb21iaW5lZFJlZ2V4ID0gbmV3IFJlZ0V4cChcbiAgICAgIHRoaXMuc2V0dGluZ3MudW53YW50ZWRQYXR0ZXJucy5qb2luKFwifFwiKSxcbiAgICAgIFwiZ1wiXG4gICAgKTtcblxuICAgIHByb2Nlc3NlZENvbnRlbnQgPSBwcm9jZXNzZWRDb250ZW50LnJlcGxhY2UoY29tYmluZWRSZWdleCwgXCJcIik7XG5cbiAgICAvLyBSZW1vdmUgb3JpZ2luYWwgdGFnXG4gICAgY29uc3QgZnJvbnRtYXR0ZXIgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZShmaWxlKT8uZnJvbnRtYXR0ZXI7XG4gICAgaWYgKGZyb250bWF0dGVyICYmIGZyb250bWF0dGVyLnRhZ3MpIHtcbiAgICAgIGNvbnN0IGZyb250bWF0dGVyVGFncyA9IHRoaXMuZ2V0VGFnTGlzdEZyb21Gcm9udG1hdHRlcihmcm9udG1hdHRlcik7XG4gICAgICBmcm9udG1hdHRlci50YWdzID0gZnJvbnRtYXR0ZXJUYWdzLmZpbHRlcihcbiAgICAgICAgKHRhZykgPT4gdGFnICE9PSB0aGlzLnNldHRpbmdzLnNvdXJjZVRhZ1xuICAgICAgKTtcbiAgICAgIGNvbnN0IHlhbWxGcm9udG1hdHRlciA9IE9iamVjdC5lbnRyaWVzKGZyb250bWF0dGVyKVxuICAgICAgICAubWFwKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBgJHtrZXl9OlxcbiR7dmFsdWUubWFwKChpdGVtKSA9PiBgICAtICR7aXRlbX1gKS5qb2luKFwiXFxuXCIpfWA7XG4gICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gYCR7a2V5fTpgO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gYCR7a2V5fTogJHt2YWx1ZX1gO1xuICAgICAgICB9KVxuICAgICAgICAuam9pbihcIlxcblwiKTtcbiAgICAgIHByb2Nlc3NlZENvbnRlbnQgPSBwcm9jZXNzZWRDb250ZW50LnJlcGxhY2UoXG4gICAgICAgIC8tLS1bXFxzXFxTXSo/LS0tLyxcbiAgICAgICAgYC0tLVxcbiR7eWFtbEZyb250bWF0dGVyfVxcbi0tLWBcbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHByb2Nlc3NlZENvbnRlbnQ7XG4gIH1cblxuICBhc3luYyB3cml0ZUZpbGUoZmlsZVBhdGg6IHN0cmluZywgY29udGVudDogc3RyaW5nKSB7XG4gICAgYXdhaXQgZnMucHJvbWlzZXMubWtkaXIocGF0aC5kaXJuYW1lKGZpbGVQYXRoKSwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgYXdhaXQgZnMucHJvbWlzZXMud3JpdGVGaWxlKGZpbGVQYXRoLCBjb250ZW50LCBcInV0ZjhcIik7XG4gIH1cbn1cblxuY2xhc3MgQ2F0ZXJwaWxsYWdlU2V0dGluZ1RhYiBleHRlbmRzIFBsdWdpblNldHRpbmdUYWIge1xuICBwbHVnaW46IENhdGVycGlsbGFnZTtcblxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBDYXRlcnBpbGxhZ2UpIHtcbiAgICBzdXBlcihhcHAsIHBsdWdpbik7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gIH1cblxuICBkaXNwbGF5KCk6IHZvaWQge1xuICAgIGNvbnN0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XG4gICAgY29udGFpbmVyRWwuZW1wdHkoKTtcblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoXCJTb3VyY2UgVGFnXCIpXG4gICAgICAuc2V0RGVzYyhcIlRhZyB0byBpZGVudGlmeSBub3RlcyB0byBiZSBjb3BpZWRcIilcbiAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PlxuICAgICAgICB0ZXh0XG4gICAgICAgICAgLnNldFBsYWNlaG9sZGVyKFwiRW50ZXIgdGFnXCIpXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnNvdXJjZVRhZylcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zb3VyY2VUYWcgPSB2YWx1ZTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIlRhcmdldCBWYXVsdCBQYXRoXCIpXG4gICAgICAuc2V0RGVzYyhcIlBhdGggdG8gdGhlIHRhcmdldCB2YXVsdFwiKVxuICAgICAgLmFkZFRleHQoKHRleHQpID0+XG4gICAgICAgIHRleHRcbiAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoXCJFbnRlciBwYXRoXCIpXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnRhcmdldFZhdWx0UGF0aClcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy50YXJnZXRWYXVsdFBhdGggPSB2YWx1ZTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIlVud2FudGVkIFBhdHRlcm5zXCIpXG4gICAgICAuc2V0RGVzYyhcIlJlZ2V4IHBhdHRlcm5zIHRvIG1hdGNoIGFuZCByZW1vdmUgdW53YW50ZWQgY29udGVudFwiKVxuICAgICAgLmFkZFRleHRBcmVhKCh0ZXh0KSA9PlxuICAgICAgICB0ZXh0XG4gICAgICAgICAgLnNldFBsYWNlaG9sZGVyKFwiRW50ZXIgdW53YW50ZWQgcmVnZXggcGF0dGVybnMgKG5ld2xpbmUtc2VwYXJhdGVkKVwiKVxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy51bndhbnRlZFBhdHRlcm5zLmpvaW4oXCJcXG5cIikpXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MudW53YW50ZWRQYXR0ZXJucyA9IHZhbHVlLnNwbGl0KFwiXFxuXCIpO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiUGF0aCBNYXBwaW5nc1wiKVxuICAgICAgLnNldERlc2MoXG4gICAgICAgIFwiTmV3bGluZS1zZXBhcmF0ZWQgc291cmNlIGFuZCBkZXN0aW5hdGlvbiBwYXRoIG1hcHBpbmdzIChlLmcuLCBzb3VyY2UxLGRlc3RpbmF0aW9uMSA8bmV3bGluZT4gc291cmNlMixkZXN0aW5hdGlvbjIpXCJcbiAgICAgIClcbiAgICAgIC5hZGRUZXh0QXJlYSgodGV4dCkgPT5cbiAgICAgICAgdGV4dFxuICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcihcIkVudGVyIHBhdGggbWFwcGluZ3NcIilcbiAgICAgICAgICAuc2V0VmFsdWUoXG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5wYXRoTWFwcGluZ3NcbiAgICAgICAgICAgICAgLm1hcCgobWFwcGluZykgPT4gbWFwcGluZy5qb2luKFwiLFwiKSlcbiAgICAgICAgICAgICAgLmpvaW4oXCJcXG5cIilcbiAgICAgICAgICApXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucGF0aE1hcHBpbmdzID0gdmFsdWVcbiAgICAgICAgICAgICAgLnNwbGl0KFwiXFxuXCIpXG4gICAgICAgICAgICAgIC5tYXAoKG1hcHBpbmcpID0+IG1hcHBpbmcuc3BsaXQoXCIsXCIpLm1hcCgoaXRlbSkgPT4gaXRlbS50cmltKCkpKTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuICB9XG59XG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQSxzQkFBOEQ7QUFDOUQsV0FBc0I7QUFDdEIsU0FBb0I7QUFTcEIsSUFBTSxtQkFBeUM7QUFBQSxFQUM3QyxXQUFXO0FBQUEsRUFDWCxpQkFBaUI7QUFBQSxFQUNqQixrQkFBa0I7QUFBQSxFQUNsQixjQUFjO0FBQUE7QUFHaEIsaUNBQTBDLHVCQUFPO0FBQUEsUUFHekMsU0FBUztBQUNiLFVBQU0sS0FBSztBQUVYLFNBQUssY0FBYyxRQUFRLHFCQUFxQixNQUFNO0FBQ3BELGNBQVEsSUFBSTtBQUNaLFdBQUs7QUFBQTtBQUdQLFNBQUssY0FBYyxJQUFJLHVCQUF1QixLQUFLLEtBQUs7QUFBQTtBQUFBLFFBR3BELGVBQWU7QUFDbkIsU0FBSyxXQUFXLE9BQU8sT0FBTyxJQUFJLGtCQUFrQixNQUFNLEtBQUs7QUFBQTtBQUFBLFFBRzNELGVBQWU7QUFDbkIsVUFBTSxLQUFLLFNBQVMsS0FBSztBQUFBO0FBQUEsRUFHM0IsMEJBQTBCLGFBQXVCO0FBQy9DLFFBQUksQ0FBQyxZQUFZLFFBQVEsWUFBWSxLQUFLLFdBQVcsR0FBRztBQUN0RCxhQUFPO0FBQUE7QUFHVCxRQUFJLE1BQU0sUUFBUSxZQUFZLE9BQU87QUFDbkMsYUFBTyxZQUFZLEtBQUssSUFBSSxDQUFDLFFBQzNCLElBQUksU0FBUyxPQUFP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
